@page "/mainViewPosts"
@using Domain.DTOs
@using HttpClients.ClientInterfaces
@inject IPostService postService
@inherits Microsoft.AspNetCore.Components.LayoutComponentBase
@using Login
@using global::Shared.Models
<PageTitle>DNP Forum</PageTitle>

<div class="page">
	<div class="sidebar">
		<NavMenu/>
	</div>

	<main>
		 <div class="top-row px-4">
                    <LoginButtons/>
                </div>
        
		<article class="content px-4">
			@Body
			<div>
				<button @onclick="LoadPosts">Load</button>
			</div>
			
			@if (posts == null)
			{
			}
			else if (!posts.Any())
			{
				<p>No Posts...</p>
			}
			else
			{
				<table class="table">
					<thead>
					<tr>
						<th>Post ID</th>
						<th>Owner ID</th>
						<th>Title</th>
						<th>Content</th>
					</tr>
					</thead>
					<tbody>
					@foreach (var item in posts)
					{
						<tr>
							<td>@item.Id</td>
							<td>@item.OwnerId.Id</td>
							<td>@item.Title</td>
							<td>@item.Content</td>
						</tr>
					}
					</tbody>
				</table>
			}
			@if (!string.IsNullOrEmpty(msg))
            {
                <label style="color: red">@msg</label>
            }
		</article>
		
		<div>
			
		</div>
	</main>
</div>

@code {
    private IEnumerable<Post>? posts;
    private string msg = "";

    private async Task LoadPosts()
    {
        try
        {
            posts = await postService.GetAsync(null, null, 0, 0);
        }
        catch (Exception e)
        {
            Console.WriteLine(e);
            msg = e.Message;
        }
    }
}


	
}